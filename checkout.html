<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Commander</title>

<style>
    body {
        margin: 0;
        padding: 0;
        background: #fafafa;
        font-family: Arial;
    }
    h1 {
        text-align: center;
        padding: 15px;
        background: #ff3d00;
        color: white;
        margin: 0;
        font-size: 26px;
    }

    form {
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    input, textarea {
        padding: 12px;
        border-radius: 10px;
        border: 1px solid #ccc;
        font-size: 17px;
        width: 100%;
        box-sizing: border-box;
    }

    .btn {
        padding: 15px;
        background: #ff3d00;
        color: white;
        font-size: 20px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: 0.3s;
    }

    .btn:hover {
        background: #ff5722;
    }

    .success {
        text-align: center;
        color: green;
        font-size: 20px;
        margin-top: 10px;
        display: none;
    }
</style>
</head>

<body>

<h1>Commander</h1>

<form id="orderForm">
    <input type="text" id="name" placeholder="Votre nom complet" required>
    <input type="tel" id="phone" placeholder="Numéro de téléphone" required>
    <textarea id="address" placeholder="Adresse complète" rows="3" required></textarea>
    <button class="btn" type="submit">Envoyer la commande</button>
</form>

<div class="success" id="successMessage">Votre commande a été envoyée ✔️</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
    const supabaseUrl = "https://gkzjbvgpfaebzeyygeqw.supabase.co";
    const supabaseKey = "sb_publishable_2LFLjpYRS3CFK3EhhNsuFw_JiIerz3z";
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    const params = new URLSearchParams(window.location.search);
    const mealId = params.get("meal");
    const restaurantId = params.get("resto");

    document.getElementById("orderForm").addEventListener("submit", async (e) => {
        e.preventDefault();

        const name = document.getElementById("name").value;
        const phone = document.getElementById("phone").value;
        const address = document.getElementById("address").value;

        const { data, error } = await supabase
            .from("orders")
            .insert([
                {
                    restaurant_id: restaurantId,
                    meal_id: mealId,
                    customer_name: name,
                    customer_phone: phone,
                    customer_address: address,
                    status: "en attente"
                }
            ]);

        if (error) {
            alert("Erreur : impossible d’envoyer la commande.");
            console.error(error);
            return;
        }

        document.getElementById("successMessage").style.display = "block";
        document.getElementById("orderForm").reset();
    });
</script>

</body>
</html>
